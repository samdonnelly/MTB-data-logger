/**
 * @file user_init.c
 * 
 * @author Sam Donnelly (samueldonnelly11@gmail.com)
 * 
 * @brief Code that gets called once at the beginning of the program
 * 
 * @version 0.1
 * @date 2022-02-12
 * 
 * @copyright Copyright (c) 2022
 * 
 */

//=======================================================================================
// Includes 

#include "user_init.h"

//=======================================================================================


// User init function 
void user_init()
{
    //===================================================
    // General setup 

    // Initialize GPIO ports 
    gpio_port_init(); 

    // Serial terminal output 
    uart_init(USART2, UART_BAUD_9600, UART_CLOCK_42); 
    
    //===================================================

    //===================================================
    // Timers 

    // General purpose counter 
    tim_9_to_11_counter_init(
        TIM9, 
        TIM_84MHZ_1US_PSC, 
        0xFFFF,  // Max ARR value 
        TIM_UP_INT_DISABLE); 
    tim_enable(TIM9); 

    //===================================================

    //===================================================
    // I2C setup 

    // For MPU-6050, LCD screen and M*Q GPS 
    i2c_init(
        I2C1, 
        I2C1_SDA_PB9,
        I2C1_SCL_PB8,
        I2C_MODE_SM,
        I2C_APB1_42MHZ,
        I2C_CCR_SM_42_100,
        I2C_TRISE_1000_42);
    
    //===================================================

    //===================================================
    // SPI setup 
    //===================================================

    //===================================================
    // UART setup 
    //===================================================

    //===================================================
    // ADC setup 
    //===================================================

    //===================================================
    // DMA setup 
    //===================================================

    //===================================================
    // MPU-6050 IMU setup 
    //===================================================

    //===================================================
    // HD44780U LCD setup 

    // Driver 
    hd44780u_init(I2C1, TIM9, PCF8574_ADDR_HHH);

    // Contoller 
    hd44780u_controller_init(); 

    //===================================================

    //===================================================
    // M8Q GPS setup 
    //===================================================

    //===================================================
    // HC-05 Bluetooth setup 
    //===================================================

    //===================================================
    // SD card setup 
    //===================================================
}
